#!/sbin/sh
# Kali NetHunter Uninstaller

console=/proc/self/fd/$2
zip="$3"
tmpdir=/tmp/nethunter-uninstall

ui_print() {
	echo "ui_print $1" > $console
}

mkdir -p $tmpdir
cd $tmpdir
unzip -o "$zip"

ui_print "***********************"
ui_print " NetHunter Uninstaller "
ui_print "***********************"

mount /system
mount /data

# Remove added firmware (folder would only exist if you installed NetHunter)
[ -d "/system/etc/firmware/rtlwifi" ] && {
	ui_print "@Removing Firmware";
	rm -rf /system/etc/firmware/rtlwifi
	rm -rf /system/etc/firmware/zd1211
	rm -f /system/etc/firmware/ar9170-1.fw
	rm -f /system/etc/firmware/ar9170-2.fw
	rm -f /system/etc/firmware/carl9170.fw
	rm -f /system/etc/firmware/htc_7010.fw
	rm -f /system/etc/firmware/rt73.bin
	rm -f /system/etc/firmware/rt2561.bin
	rm -f /system/etc/firmware/rt2860.bin
	rm -f /system/etc/firmware/rt2870.bin
	rm -f /system/etc/firmware/rt3070.bin
}

[ -d "/system/priv-app/NetHunter" ] && {
	ui_print "@Removing NetHunter.apk"
	rm -rf /system/priv-app/NetHunter
}

[ -d "/data/data/com.offsec.nethunter" ] && {
	ui_print "@Removing NetHunter chroot/data"
	rm -rf /data/data/com.offsec.nethunter
}

umount /system
umount /data

ui_print "@Uninstall complete"
